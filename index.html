<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inyo – Intake Wizard</title>
<style>
  /* Light theme + Inyo lavender accents */
  :root{
    --bg:#ffffff;
    --card:#ffffff;
    --stroke:#e7e9f2;
    --text:#111318;
    --muted:#667085;
    --lav:#6f66ff;    /* primary lavender */
    --lav2:#b9b4ff;   /* soft lavender */
    --focus:rgba(111,102,255,.25);
    --success:#0a7f4a;
    --danger:#d92d20;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;color:var(--text)}
  a{color:var(--lav);text-decoration:none}

  /* Sticky header with subtle shimmer */
  .topbar{position:sticky;top:0;z-index:1000;background:#fff;border-bottom:1px solid var(--stroke);box-shadow:0 2px 12px rgba(16,24,40,.04)}
  .topbar-inner{max-width:980px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:10px 14px}
  .brand-left{display:flex;align-items:center;gap:10px}
  .brand-left img.logo{height:22px;width:auto;display:block}
  .tagline{font-size:12px;color:var(--muted)}
  .shimmer{height:2px;background:linear-gradient(90deg,transparent,var(--lav2),transparent);background-size:200% 100%;animation:shine 3s linear infinite}
  @keyframes shine{0%{background-position:200% 0}100%{background-position:-200% 0}}

  .wrap{max-width:980px;margin:24px auto;padding:16px}
  .card{background:var(--card);border:1px solid var(--stroke);border-radius:16px;box-shadow:0 8px 24px rgba(16,24,40,.06);overflow:hidden}

  /* Stepper */
  .stepper{display:flex;align-items:center;gap:12px;padding:16px 18px;border-bottom:1px solid var(--stroke);background:#fafaff}
  .step{display:flex;align-items:center;gap:8px;color:#8a8fb0;font-weight:600}
  .step .dot{width:26px;height:26px;border-radius:50%;display:inline-grid;place-items:center;border:2px solid #d8dbf0;background:#fff;color:#6b6f8f;font-size:13px}
  .step.active{color:#2f2b88}
  .step.active .dot{border-color:transparent;background:linear-gradient(90deg,var(--lav),var(--lav2));color:#fff}
  .step.done{color:#2f2b88}
  .step.done .dot{border-color:#c8ccff;background:#eff1ff;color:#2f2b88}
  .step-line{flex:1;height:2px;background:linear-gradient(90deg,#e7e9f2,#e7e9f2)}
  .step-line.filled{background:linear-gradient(90deg,var(--lav),var(--lav2))}

  header{padding:22px 22px 6px}
  header h1{margin:0;font-size:22px}
  header p{margin:6px 0 0;color:var(--muted);font-size:14px}

  form{padding:0 22px 22px}
  .hidden{display:none}

  /* Layout bits */
  .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media (max-width:900px){.row{grid-template-columns:1fr}}
  label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
  input[type="text"], input[type="email"], textarea{
    width:100%;padding:12px;border-radius:12px;border:1px solid var(--stroke);background:#fff;color:var(--text);outline:none
  }
  input:focus, textarea:focus{border-color:var(--lav);box-shadow:0 0 0 4px var(--focus)}
  textarea{min-height:88px;resize:vertical}

  /* Big two-column product panels */
  .panes{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:14px}
  @media (max-width:900px){.panes{grid-template-columns:1fr}}
  .pane{border:1px solid var(--stroke);border-radius:14px;background:#fff;overflow:hidden}
  .pane h3{margin:0;padding:12px 14px;background:#fafaff;border-bottom:1px solid var(--stroke);font-size:15px}
  .product{display:flex;align-items:flex-start;gap:10px;padding:12px 14px;border-bottom:1px solid var(--stroke)}
  .product:last-child{border-bottom:none}
  .product input{margin-top:3px;accent-color:var(--lav)}
  .p-meta{flex:1}
  .p-title{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .p-title span{font-size:14px;font-weight:600}
  .p-desc{color:#6b7280;font-size:12px;margin-top:4px}
  .p-comment{margin-top:8px}
  .p-comment textarea{min-height:64px}

  .divider{height:1px;background:var(--stroke);margin:18px 0}

  /* Actions */
  .actions{display:flex;align-items:center;gap:10px;margin:18px 0}
  .right{margin-left:auto}
  button{border:0;border-radius:12px;padding:12px 16px;cursor:pointer;font-weight:700}
  .primary{background:linear-gradient(90deg,var(--lav),var(--lav2));color:#fff}
  .ghost{background:#fff;border:1px solid var(--stroke);color:var(--text)}
  .error{color:var(--danger);font-size:13px;margin-top:8px;display:none}

  footer{padding:12px 22px;color:#98a2b3;font-size:12px;text-align:center;border-top:1px solid var(--stroke);background:#fafafa}

  /* Modal review */
  .modal-backdrop{position:fixed;inset:0;background:rgba(17,19,24,.45);display:none;align-items:center;justify-content:center;padding:16px;z-index:2000}
  .modal{max-width:820px;width:100%;background:#fff;border-radius:16px;border:1px solid var(--stroke);box-shadow:0 12px 40px rgba(16,24,40,.18);overflow:hidden}
  .modal header{padding:16px 18px;border-bottom:1px solid var(--stroke)}
  .modal .content{padding:16px 18px}
  .summary-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:800px){.summary-grid{grid-template-columns:1fr}}
  .summary-item{border:1px solid var(--stroke);border-radius:12px;padding:10px;background:#fff}
  .summary-item b{display:block;margin-bottom:6px;color:#344054}
  .modal .actions{padding:14px 18px;border-top:1px solid var(--stroke);display:flex;justify-content:flex-end}

  /* Thank you */
  .thankyou{display:none;max-width:980px;margin:28px auto;padding:16px}
  .ty-card{background:#fff;border:1px solid var(--stroke);border-radius:16px;box-shadow:0 8px 24px rgba(16,24,40,.06);padding:22px}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#eff1ff;color:#2f2b88;font-weight:700;font-size:12px;margin-bottom:10px}
</style>
</head>
<body>
  <!-- Sticky header -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand-left">
        <!-- Swap the src to change logo, e.g., src="inyo-logo-new.png" -->
        <img class="logo" src="inyo-logo.png" alt="Inyo" />
        <span class="tagline">Payments • Compliance • Global Payouts</span>
      </div>
    </div>
    <div class="shimmer" aria-hidden="true"></div>
  </div>

  <div class="wrap">
    <div class="card" id="wizardCard">
      <!-- Stepper -->
      <div class="stepper">
        <div class="step active" data-step="1"><span class="dot">1</span>Welcome</div>
        <div class="step-line" id="line12"></div>
        <div class="step" data-step="2"><span class="dot">2</span>Products</div>
        <div class="step-line" id="line23"></div>
        <div class="step" data-step="3"><span class="dot">3</span>Company Info</div>
        <div class="step-line" id="line34"></div>
        <div class="step" data-step="4"><span class="dot">4</span>Review</div>
      </div>

      <form id="intakeForm">
        <!-- STEP 1: Welcome -->
        <section id="step1">
          <header>
            <h1>Welcome to Inyo Intake</h1>
            <p>Quick 3-step flow: pick your products, share company details, then review & confirm. You can resubmit anytime if you change your mind.</p>
          </header>
          <div class="divider"></div>
          <div class="row">
            <div>
              <label for="company">Legal Company / Personal Name *</label>
              <input id="company" name="company" type="text" placeholder="e.g., Atlas Fintech Inc." required />
            </div>
            <div>
              <label for="email">Email (optional)</label>
              <input id="email" name="email" type="email" placeholder="name@example.com" />
            </div>
          </div>
          <div class="error" id="errStep1">Please enter your company/personal name.</div>
          <div class="actions">
            <button type="button" class="primary right" id="toStep2">Start</button>
          </div>
        </section>

        <!-- STEP 2: Products (two big panes) -->
        <section id="step2" class="hidden">
          <header>
            <h1>Select Products</h1>
            <p>Pick any **Pay-In** and **Payout** methods. Add a note under each product if you want to clarify, include, or exclude something.</p>
          </header>

          <div class="panes">
            <!-- Pay-In -->
            <div class="pane">
              <h3>Pay-In Methods</h3>
              <!-- Each product -->
              <div class="product">
                <input type="checkbox" name="products" value="Regulated/Unregulated Debit Cards" id="pi-debit">
                <div class="p-meta">
                  <div class="p-title"><label for="pi-debit"><span>Regulated / Unregulated Debit Cards</span></label></div>
                  <div class="p-desc">Bank-linked (regulated) or program (unregulated) cards to fund accounts quickly.</div>
                  <div class="p-comment hidden" data-for="pi-debit">
                    <label for="comment_pi-debit">Comments for this product</label>
                    <textarea name="comment_pi-debit" id="comment_pi-debit" placeholder="e.g., exclude prepaid; need BIN ranges"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Mastercard Move" id="pi-move">
                <div class="p-meta">
                  <div class="p-title"><label for="pi-move"><span>Mastercard Move</span></label></div>
                  <div class="p-desc">Real-time transfers to cards, bank accounts, or wallets via Mastercard rails.</div>
                  <div class="p-comment hidden" data-for="pi-move">
                    <label for="comment_pi-move">Comments for this product</label>
                    <textarea name="comment_pi-move" id="comment_pi-move" placeholder="Corridors or limits?"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="AFT" id="pi-aft">
                <div class="p-meta">
                  <div class="p-title"><label for="pi-aft"><span>AFT (Account Funding Transaction)</span></label></div>
                  <div class="p-desc">Pull funds from a card to load an account or wallet securely.</div>
                  <div class="p-comment hidden" data-for="pi-aft">
                    <label for="comment_pi-aft">Comments for this product</label>
                    <textarea name="comment_pi-aft" id="comment_pi-aft" placeholder="Card types, KYC posture, etc."></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Credit Cards" id="pi-cc">
                <div class="p-meta">
                  <div class="p-title"><label for="pi-cc"><span>Credit Cards</span></label></div>
                  <div class="p-desc">Use bank-issued cards to fund accounts or make payments globally.</div>
                  <div class="p-comment hidden" data-for="pi-cc">
                    <label for="comment_pi-cc">Comments for this product</label>
                    <textarea name="comment_pi-cc" id="comment_pi-cc"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Wire" id="pi-wire">
                <div class="p-meta">
                  <div class="p-title"><label for="pi-wire"><span>Wire Transfers</span></label></div>
                  <div class="p-desc">Direct bank-to-bank transfers for larger or B2B payments.</div>
                  <div class="p-comment hidden" data-for="pi-wire">
                    <label for="comment_pi-wire">Comments for this product</label>
                    <textarea name="comment_pi-wire" id="comment_pi-wire"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="ACH" id="pi-ach">
                <div class="p-meta">
                  <div class="p-title"><label for="pi-ach"><span>ACH (Automated Clearing House)</span></label></div>
                  <div class="p-desc">U.S. low-cost electronic bank-to-bank transfers; great for recurring payments.</div>
                  <div class="p-comment hidden" data-for="pi-ach">
                    <label for="comment_pi-ach">Comments for this product</label>
                    <textarea name="comment_pi-ach" id="comment_pi-ach"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Visa Direct to Card - Domestic" id="pi-vdd">
                <div class="p-meta">
                  <div class="p-title"><label for="pi-vdd"><span>Visa Direct to Card – Domestic</span></label></div>
                  <div class="p-desc">Instant push-to-card within the same country.</div>
                  <div class="p-comment hidden" data-for="pi-vdd">
                    <label for="comment_pi-vdd">Comments for this product</label>
                    <textarea name="comment_pi-vdd" id="comment_pi-vdd"></textarea>
                  </div>
                </div>
              </div>
            </div>

            <!-- Payout -->
            <div class="pane">
              <h3>Payout Methods</h3>

              <div class="product">
                <input type="checkbox" name="products" value="Domestic Wire" id="po-wire-dom">
                <div class="p-meta">
                  <div class="p-title"><label for="po-wire-dom"><span>Domestic Wire</span></label></div>
                  <div class="p-desc">Send payouts to local bank accounts via same-country wire.</div>
                  <div class="p-comment hidden" data-for="po-wire-dom">
                    <label for="comment_po-wire-dom">Comments for this product</label>
                    <textarea name="comment_po-wire-dom" id="comment_po-wire-dom"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="International Wire (SWIFT)" id="po-swift">
                <div class="p-meta">
                  <div class="p-title"><label for="po-swift"><span>International Wire (SWIFT)</span></label></div>
                  <div class="p-desc">Cross-border transfers via SWIFT in multiple currencies.</div>
                  <div class="p-comment hidden" data-for="po-swift">
                    <label for="comment_po-swift">Comments for this product</label>
                    <textarea name="comment_po-swift" id="comment_po-swift"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Push to Account" id="po-pta">
                <div class="p-meta">
                  <div class="p-title"><label for="po-pta"><span>Push to Account</span></label></div>
                  <div class="p-desc">Send funds directly to a recipient’s bank account.</div>
                  <div class="p-comment hidden" data-for="po-pta">
                    <label for="comment_po-pta">Comments for this product</label>
                    <textarea name="comment_po-pta" id="comment_po-pta"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Push to Card - Cross-Border" id="po-ptc">
                <div class="p-meta">
                  <div class="p-title"><label for="po-ptc"><span>Push to Card – Cross-Border</span></label></div>
                  <div class="p-desc">International card payouts (e.g., OCT) to cards abroad.</div>
                  <div class="p-comment hidden" data-for="po-ptc">
                    <label for="comment_po-ptc">Comments for this product</label>
                    <textarea name="comment_po-ptc" id="comment_po-ptc"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Push to Wallet" id="po-ptw">
                <div class="p-meta">
                  <div class="p-title"><label for="po-ptw"><span>Push to Wallet</span></label></div>
                  <div class="p-desc">Deliver funds to mobile/digital wallets in supported regions.</div>
                  <div class="p-comment hidden" data-for="po-ptw">
                    <label for="comment_po-ptw">Comments for this product</label>
                    <textarea name="comment_po-ptw" id="comment_po-ptw"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Inyo Network Account" id="po-ina">
                <div class="p-meta">
                  <div class="p-title"><label for="po-ina"><span>Inyo Network Account</span></label></div>
                  <div class="p-desc">Receive payouts into an Inyo account; keep funds in-ecosystem.</div>
                  <div class="p-comment hidden" data-for="po-ina">
                    <label for="comment_po-ina">Comments for this product</label>
                    <textarea name="comment_po-ina" id="comment_po-ina"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Cash" id="po-cash">
                <div class="p-meta">
                  <div class="p-title"><label for="po-cash"><span>Cash</span></label></div>
                  <div class="p-desc">Cash pickup via partner locations (corridor-dependent).</div>
                  <div class="p-comment hidden" data-for="po-cash">
                    <label for="comment_po-cash">Comments for this product</label>
                    <textarea name="comment_po-cash" id="comment_po-cash"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Wallet" id="po-wallet">
                <div class="p-meta">
                  <div class="p-title"><label for="po-wallet"><span>Wallet</span></label></div>
                  <div class="p-desc">Pay into mobile/digital wallets used in many regions.</div>
                  <div class="p-comment hidden" data-for="po-wallet">
                    <label for="comment_po-wallet">Comments for this product</label>
                    <textarea name="comment_po-wallet" id="comment_po-wallet"></textarea>
                  </div>
                </div>
              </div>

              <div class="product">
                <input type="checkbox" name="products" value="Debit Cards" id="po-debit">
                <div class="p-meta">
                  <div class="p-title"><label for="po-debit"><span>Debit Cards (Payout)</span></label></div>
                  <div class="p-desc">Payouts directly to recipients’ cards for convenience.</div>
                  <div class="p-comment hidden" data-for="po-debit">
                    <label for="comment_po-debit">Comments for this product</label>
                    <textarea name="comment_po-debit" id="comment_po-debit"></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="error" id="errStep2">Please choose at least one product (Pay-In or Payout).</div>
          <div class="actions">
            <button type="button" class="ghost" id="backTo1">Back</button>
            <button type="button" class="primary right" id="toStep3">Next</button>
          </div>
        </section>

        <!-- STEP 3: Company Information & Operations -->
        <section id="step3" class="hidden">
          <header>
            <h1>Company Information & Operations</h1>
            <p>Short answers are fine. You can always resubmit later.</p>
          </header>

          <div class="row">
            <div>
              <label for="business_model">Briefly describe your core business model</label>
              <textarea id="business_model" name="business_model"></textarea>
            </div>
            <div>
              <label for="wallets_funded">How are wallets/accounts funded?</label>
              <textarea id="wallets_funded" name="wallets_funded"></textarea>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="funds_flow">Explain the full funds flow (with counterparties)</label>
              <textarea id="funds_flow" name="funds_flow"></textarea>
            </div>
            <div>
              <label for="avg_ticket">Average ticket</label>
              <input id="avg_ticket" name="avg_ticket" type="text" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="monthly_volume">Monthly transaction volume</label>
              <input id="monthly_volume" name="monthly_volume" type="text" />
            </div>
            <div>
              <label for="send_countries">Main sending countries</label>
              <input id="send_countries" name="send_countries" type="text" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="receive_countries">Main receiving countries</label>
              <input id="receive_countries" name="receive_countries" type="text" />
            </div>
            <div>
              <label for="partners">Current partners/providers (banks, PSPs, processors)</label>
              <input id="partners" name="partners" type="text" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="corridor_restrictions">Any restrictions in corridors (US, Canada, Nigeria, Ghana)?</label>
              <input id="corridor_restrictions" name="corridor_restrictions" type="text" />
            </div>
            <div>
              <label for="settlement_currency">Preferred settlement currency</label>
              <input id="settlement_currency" name="settlement_currency" type="text" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="settlement_frequency">Settlement frequency (daily, weekly, etc.)</label>
              <input id="settlement_frequency" name="settlement_frequency" type="text" />
            </div>
            <div>
              <label for="ops_requirements">Any special operational requirements or constraints?</label>
              <input id="ops_requirements" name="ops_requirements" type="text" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="key_challenges">Key challenges you want us to solve</label>
              <textarea id="key_challenges" name="key_challenges"></textarea>
            </div>
            <div>
              <label for="other_notes">Anything else we should know to prepare a proposal</label>
              <textarea id="other_notes" name="other_notes"></textarea>
            </div>
          </div>

          <div class="actions">
            <button type="button" class="ghost" id="backTo2">Back</button>
            <button type="button" class="primary right" id="toStep4">Review</button>
          </div>
        </section>

        <!-- STEP 4: (opens modal) -->
        <section id="step4" class="hidden"></section>

        <!-- Hidden meta (filled at send time) -->
        <input type="hidden" name="_subject" value="New Inyo Intake" />
        <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off" />
      </form>

      <footer>© Inyo Global — All rights reserved.</footer>
    </div>

    <!-- Thank You -->
    <div class="thankyou" id="thankYou">
      <div class="ty-card">
        <span class="badge">Thank you</span>
        <h2 style="margin:6px 0 4px 0;">Your intake was submitted to Inyo.</h2>
        <p style="color:#475467">If anything changes, you can submit a new form any time.</p>
        <div class="divider"></div>
        <div id="thankYouSummary"></div>
      </div>
    </div>
  </div>

  <!-- Review Modal -->
  <div class="modal-backdrop" id="reviewBackdrop" role="dialog" aria-modal="true" aria-labelledby="reviewTitle">
    <div class="modal">
      <header><h3 id="reviewTitle" style="margin:0">Please confirm your details</h3></header>
      <div class="content">
        <p style="margin:0 0 10px 0;color:#475467">Check your selections and answers below. If anything is wrong, close and edit; otherwise click <b>Confirm & Send</b>.</p>
        <div class="summary-grid" id="summaryGrid"></div>
      </div>
      <div class="actions">
        <button class="ghost" id="btnEdit" type="button">Edit</button>
        <button class="primary" id="btnConfirm" type="button">Confirm & Send</button>
      </div>
    </div>
  </div>

<script>
  /* -------- Stepper helpers -------- */
  const steps = Array.from(document.querySelectorAll('.stepper .step'));
  const lines = { line12: document.getElementById('line12'), line23: document.getElementById('line23'), line34: document.getElementById('line34') };
  function setStep(n){
    steps.forEach(s=>{
      const num = +s.dataset.step;
      s.classList.toggle('active', num===n);
      s.classList.toggle('done', num<n);
    });
    lines.line12.classList.toggle('filled', n>1);
    lines.line23.classList.toggle('filled', n>2);
    lines.line34.classList.toggle('filled', n>3);
    ['step1','step2','step3','step4'].forEach((id,i)=>{
      document.getElementById(id).classList.toggle('hidden', (i+1)!==n);
    });
  }

  /* -------- Elements -------- */
  const form = document.getElementById('intakeForm');
  const toStep2 = document.getElementById('toStep2');
  const toStep3 = document.getElementById('toStep3');
  const toStep4 = document.getElementById('toStep4');
  const backTo1 = document.getElementById('backTo1');
  const backTo2 = document.getElementById('backTo2');
  const errStep1 = document.getElementById('errStep1');
  const errStep2 = document.getElementById('errStep2');
  const thankYou = document.getElementById('thankYou');
  const wizardCard = document.getElementById('wizardCard');
  const reviewBackdrop = document.getElementById('reviewBackdrop');
  const summaryGrid = document.getElementById('summaryGrid');
  const btnEdit = document.getElementById('btnEdit');
  const btnConfirm = document.getElementById('btnConfirm');
  const thankYouSummary = document.getElementById('thankYouSummary');

  /* -------- Product comment toggles -------- */
  document.querySelectorAll('.product input[type="checkbox"]').forEach(cb=>{
    const cbox = cb;
    const block = document.querySelector(`.p-comment[data-for="${cb.id}"]`);
    if(!block) return;
    const update = ()=> block.classList.toggle('hidden', !cbox.checked);
    cb.addEventListener('change', update);
    update();
  });

  /* -------- Validation helpers -------- */
  const selectedProducts = () =>
    Array.from(document.querySelectorAll('input[name="products"]:checked')).map(x=>x.value);

  /* -------- Step navigation -------- */
  toStep2.addEventListener('click', ()=>{
    const nameOk = document.getElementById('company').value.trim().length > 1;
    errStep1.style.display = nameOk ? 'none' : 'block';
    if(!nameOk) return;
    setStep(2);
  });
  backTo1.addEventListener('click', ()=> setStep(1));

  toStep3.addEventListener('click', ()=>{
    const any = selectedProducts().length>0;
    errStep2.style.display = any ? 'none' : 'block';
    if(!any) return;
    setStep(3);
  });
  backTo2.addEventListener('click', ()=> setStep(2));

  toStep4.addEventListener('click', ()=>{
    buildAndShowSummary();
    setStep(4);
  });

  /* -------- Summary builder -------- */
  function buildData(){
    // Gather per-product comments too
    const prod = selectedProducts();
    const productDetails = prod.map(v=>{
      const id = document.querySelector(`input[name="products"][value="${v}"]`).id;
      const commentEl = document.getElementById(`comment_${id}`);
      const value = commentEl ? commentEl.value.trim() : (document.querySelector(`[name="comment_${id}"]`)?.value.trim() || '');
      return commentEl ? `${v} — ${value || 'no comments'}` : v;
    });

    return {
      'Legal Name': document.getElementById('company').value.trim(),
      'Email': document.getElementById('email').value.trim() || '—',
      'Products Selected': productDetails.length ? productDetails.join('; ') : '—',
      'Business model': document.getElementById('business_model').value.trim() || '—',
      'Wallets/accounts funded': document.getElementById('wallets_funded').value.trim() || '—',
      'Funds flow': document.getElementById('funds_flow').value.trim() || '—',
      'Average ticket': document.getElementById('avg_ticket').value.trim() || '—',
      'Monthly volume': document.getElementById('monthly_volume').value.trim() || '—',
      'Sending countries': document.getElementById('send_countries').value.trim() || '—',
      'Receiving countries': document.getElementById('receive_countries').value.trim() || '—',
      'Partners/providers': document.getElementById('partners').value.trim() || '—',
      'Corridor restrictions': document.getElementById('corridor_restrictions').value.trim() || '—',
      'Settlement currency': document.getElementById('settlement_currency').value.trim() || '—',
      'Settlement frequency': document.getElementById('settlement_frequency').value.trim() || '—',
      'Operational reqs': document.getElementById('ops_requirements').value.trim() || '—',
      'Key challenges': document.getElementById('key_challenges').value.trim() || '—',
      'Other notes': document.getElementById('other_notes').value.trim() || '—'
    };
  }

  function renderSummary(container, data){
    container.innerHTML = '';
    Object.entries(data).forEach(([k,v])=>{
      const div = document.createElement('div');
      div.className = 'summary-item';
      div.innerHTML = `<b>${k}</b><div>${(typeof v === 'string' ? v : String(v)).replace(/\n/g,'<br>')}</div>`;
      container.appendChild(div);
    });
  }

  function buildAndShowSummary(){
    const data = buildData();
    renderSummary(summaryGrid, data);
    reviewBackdrop.style.display = 'flex';
  }

  btnEdit.addEventListener('click', ()=>{ reviewBackdrop.style.display='none'; });

  /* -------- Confirm & Send -------- */
  btnConfirm.addEventListener('click', async ()=>{
    const endpoint = "https://formspree.io/f/mzzjjppa";

    const fd = new FormData(form);
    // Include explicit list of product comments (only for checked ones)
    document.querySelectorAll('.product input[type="checkbox"]').forEach(cb=>{
      const id = cb.id;
      const commentEl = document.getElementById(`comment_${id}`) || document.querySelector(`[name="comment_${id}"]`);
      if(cb.checked && commentEl){
        fd.append(`comment_for_${cb.value}`, commentEl.value.trim());
      }
    });

    const chosen = selectedProducts().join(', ');
    fd.set('_subject', `New Inyo Intake – ${document.getElementById('company').value} – ${chosen}`);

    try{
      const res = await fetch(endpoint, { method:'POST', body: fd, headers:{ 'Accept':'application/json' }});
      reviewBackdrop.style.display='none';
      wizardCard.style.display='none';
      const data = buildData();
      renderSummary(thankYouSummary, data);
      document.getElementById('thankYou').style.display='block';

      if(!res.ok){
        const p = document.createElement('p');
        p.style.color = '#b42318';
        p.style.marginTop = '10px';
        p.textContent = "We submitted your info, but the email service responded with a warning. If you don't see a confirmation email, you can submit again.";
        thankYouSummary.appendChild(p);
      }
    }catch(e){
      reviewBackdrop.style.display='none';
      alert("Network error while sending. You can try again, or refresh the page.");
    }
  });

  // Start on step 1
  setStep(1);
</script>
</body>
</html>
